<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p674" style="overflow: hidden; position: relative; background-color: white; width: 640px; height: 853px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_674{left:80px;bottom:738px;letter-spacing:-0.23px;}
#t2_674{left:101px;bottom:739px;letter-spacing:-0.27px;}
#t3_674{left:190px;bottom:738px;}
#t4_674{left:198px;bottom:738px;letter-spacing:-0.12px;word-spacing:-0.19px;}
#t5_674{left:294px;bottom:738px;letter-spacing:-0.14px;word-spacing:-0.15px;}
#t6_674{left:80px;bottom:716px;letter-spacing:-0.14px;}
#t7_674{left:80px;bottom:690px;}
#t8_674{left:88px;bottom:690px;letter-spacing:0.23px;}
#t9_674{left:140px;bottom:690px;}
#ta_674{left:147px;bottom:690px;letter-spacing:0.23px;word-spacing:4.33px;}
#tb_674{left:333px;bottom:690px;}
#tc_674{left:95px;bottom:671px;}
#td_674{left:102px;bottom:671px;letter-spacing:0.23px;}
#te_674{left:214px;bottom:671px;}
#tf_674{left:221px;bottom:671px;letter-spacing:0.23px;}
#tg_674{left:273px;bottom:671px;}
#th_674{left:281px;bottom:671px;letter-spacing:0.23px;}
#ti_674{left:310px;bottom:671px;}
#tj_674{left:229px;bottom:651px;}
#tk_674{left:236px;bottom:651px;letter-spacing:0.23px;word-spacing:4.33px;}
#tl_674{left:466px;bottom:651px;letter-spacing:0.23px;}
#tm_674{left:214px;bottom:632px;}
#tn_674{left:221px;bottom:632px;letter-spacing:0.23px;word-spacing:4.33px;}
#to_674{left:407px;bottom:632px;letter-spacing:0.23px;}
#tp_674{left:80px;bottom:601px;letter-spacing:-0.27px;}
#tq_674{left:182px;bottom:600px;letter-spacing:-0.13px;word-spacing:-0.07px;}
#tr_674{left:472px;bottom:600px;letter-spacing:-0.12px;word-spacing:-0.09px;}
#ts_674{left:557px;bottom:600px;}
#tt_674{left:80px;bottom:578px;letter-spacing:-0.14px;word-spacing:1.66px;}
#tu_674{left:80px;bottom:556px;letter-spacing:-0.14px;word-spacing:1.6px;}
#tv_674{left:80px;bottom:534px;letter-spacing:-0.14px;}
#tw_674{left:106px;bottom:513px;letter-spacing:-0.18px;word-spacing:0.8px;}
#tx_674{left:80px;bottom:491px;letter-spacing:-0.14px;word-spacing:0.72px;}
#ty_674{left:80px;bottom:469px;letter-spacing:-0.14px;word-spacing:-0.84px;}
#tz_674{left:80px;bottom:447px;letter-spacing:-0.16px;word-spacing:2.16px;}
#t10_674{left:80px;bottom:426px;letter-spacing:-0.16px;}
#t11_674{left:130px;bottom:427px;letter-spacing:-0.27px;}
#t12_674{left:146px;bottom:426px;letter-spacing:-0.13px;word-spacing:-0.45px;}
#t13_674{left:403px;bottom:427px;letter-spacing:-0.27px;}
#t14_674{left:423px;bottom:426px;letter-spacing:-0.14px;word-spacing:-0.44px;}
#t15_674{left:80px;bottom:404px;letter-spacing:-0.15px;word-spacing:0.58px;}
#t16_674{left:228px;bottom:405px;letter-spacing:-0.27px;}
#t17_674{left:245px;bottom:404px;letter-spacing:-0.18px;word-spacing:0.66px;}
#t18_674{left:80px;bottom:382px;letter-spacing:-0.13px;word-spacing:0.47px;}
#t19_674{left:80px;bottom:360px;letter-spacing:-0.16px;word-spacing:1.68px;}
#t1a_674{left:80px;bottom:339px;letter-spacing:-0.19px;word-spacing:0.14px;}
#t1b_674{left:80px;bottom:317px;letter-spacing:-0.13px;word-spacing:-0.43px;}
#t1c_674{left:80px;bottom:295px;letter-spacing:-0.17px;word-spacing:0.06px;}
#t1d_674{left:167px;bottom:295px;letter-spacing:-0.14px;word-spacing:0.03px;}
#t1e_674{left:259px;bottom:297px;letter-spacing:-0.27px;}
#t1f_674{left:360px;bottom:295px;letter-spacing:-0.15px;}
#t1g_674{left:80px;bottom:269px;}
#t1h_674{left:88px;bottom:269px;letter-spacing:0.23px;}
#t1i_674{left:140px;bottom:269px;}
#t1j_674{left:147px;bottom:269px;letter-spacing:0.23px;word-spacing:4.33px;}
#t1k_674{left:466px;bottom:269px;}
#t1l_674{left:95px;bottom:250px;}
#t1m_674{left:102px;bottom:250px;letter-spacing:0.23px;}
#t1n_674{left:132px;bottom:250px;letter-spacing:0.23px;}
#t1o_674{left:147px;bottom:250px;letter-spacing:0.23px;}
#t1p_674{left:229px;bottom:250px;}
#t1q_674{left:236px;bottom:250px;letter-spacing:0.23px;word-spacing:4.33px;}
#t1r_674{left:414px;bottom:250px;letter-spacing:0.23px;}
#t1s_674{left:110px;bottom:231px;}
#t1t_674{left:117px;bottom:231px;letter-spacing:0.23px;}
#t1u_674{left:147px;bottom:231px;letter-spacing:0.23px;}
#t1v_674{left:162px;bottom:231px;letter-spacing:0.23px;}
#t1w_674{left:258px;bottom:231px;}
#t1x_674{left:266px;bottom:231px;letter-spacing:0.23px;word-spacing:4.33px;}
#t1y_674{left:355px;bottom:211px;}
#t1z_674{left:362px;bottom:211px;letter-spacing:0.23px;word-spacing:4.33px;}
#t20_674{left:518px;bottom:211px;}
#t21_674{left:355px;bottom:192px;letter-spacing:0.23px;}
#t22_674{left:437px;bottom:192px;letter-spacing:0.23px;}
#t23_674{left:125px;bottom:173px;}
#t24_674{left:132px;bottom:173px;letter-spacing:0.23px;}
#t25_674{left:154px;bottom:173px;}
#t26_674{left:162px;bottom:173px;letter-spacing:0.23px;}
#t27_674{left:192px;bottom:173px;letter-spacing:0.23px;word-spacing:4.32px;}
#t28_674{left:340px;bottom:173px;}
#t29_674{left:154px;bottom:154px;letter-spacing:0.23px;}
#t2a_674{left:154px;bottom:135px;}
#t2b_674{left:162px;bottom:135px;letter-spacing:0.23px;}
#t2c_674{left:206px;bottom:135px;}
#t2d_674{left:214px;bottom:135px;letter-spacing:0.23px;word-spacing:4.33px;}
#t2e_674{left:362px;bottom:135px;}
#t2f_674{left:206px;bottom:116px;}
#t2g_674{left:214px;bottom:116px;letter-spacing:0.23px;word-spacing:4.33px;}
#t2h_674{left:429px;bottom:116px;letter-spacing:0.23px;}
#t2i_674{left:309px;bottom:72px;letter-spacing:-0.16px;}

.s1_674{font-size:17px;font-family:LinLibertineO_gnp;color:#000;}
.s2_674{font-size:14px;font-family:InconsolataLGC_go0;color:#000;}
.s3_674{font-size:17px;font-family:LinLibertineO_gnp;color:#80171F;}
.s4_674{font-size:12px;font-family:InconsolataLGC_go0;color:#686868;}
.s5_674{font-size:12px;font-family:InconsolataLGC-Bold_goe;color:#4172A3;}
.s6_674{font-size:12px;font-family:InconsolataLGC_go0;color:#262626;}
.s7_674{font-size:12px;font-family:InconsolataLGC_go0;color:#7040A0;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts674" type="text/css" >

@font-face {
	font-family: InconsolataLGC-Bold_goe;
	src: url("fonts/InconsolataLGC-Bold_goe.woff") format("woff");
}

@font-face {
	font-family: InconsolataLGC_go0;
	src: url("fonts/InconsolataLGC_go0.woff") format("woff");
}

@font-face {
	font-family: LinLibertineO_gnp;
	src: url("fonts/LinLibertineO_gnp.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg674Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg674" style="-webkit-user-select: none;"><svg id="pdf674" width="640" height="853" viewBox="0 0 640 853" style="width:640px; height:853px; -moz-transform:scale(1); z-index: 0; isolation: isolate;" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<defs>
</defs>
</svg></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_674" class="t s1_674">by </span><span id="t2_674" class="t s2_674">fetch-rules</span><span id="t3_674" class="t s1_674">, </span><span id="t4_674" class="t s3_674">Section 4.4.4.5</span><span id="t5_674" class="t s1_674">) and combines the resulting streams of </span>
<span id="t6_674" class="t s1_674">frames. </span>
<span id="t7_674" class="t s4_674">(</span><span id="t8_674" class="t s5_674">define </span><span id="t9_674" class="t s4_674">(</span><span id="ta_674" class="t s6_674">apply-rules pattern frame</span><span id="tb_674" class="t s4_674">) </span>
<span id="tc_674" class="t s4_674">(</span><span id="td_674" class="t s6_674">stream-flatmap </span><span id="te_674" class="t s4_674">(</span><span id="tf_674" class="t s5_674">lambda </span><span id="tg_674" class="t s4_674">(</span><span id="th_674" class="t s6_674">rule</span><span id="ti_674" class="t s4_674">) </span>
<span id="tj_674" class="t s4_674">(</span><span id="tk_674" class="t s6_674">apply-a-rule rule pattern frame</span><span id="tl_674" class="t s4_674">)) </span>
<span id="tm_674" class="t s4_674">(</span><span id="tn_674" class="t s6_674">fetch-rules pattern frame</span><span id="to_674" class="t s4_674">))) </span>
<span id="tp_674" class="t s2_674">apply-a-rule </span><span id="tq_674" class="t s1_674">applies rules using the method outlined in </span><span id="tr_674" class="t s3_674">Section 4.4.2</span><span id="ts_674" class="t s1_674">. </span>
<span id="tt_674" class="t s1_674" data-mappings='[[3,"fi"]]'>It ﬁrst augments its argument frame by unifying the rule conclusion </span>
<span id="tu_674" class="t s1_674">with the paern in the given frame. If this succeeds, it evaluates the </span>
<span id="tv_674" class="t s1_674">rule body in this new frame. </span>
<span id="tw_674" class="t s1_674">Before any of this happens, however, the program renames all the </span>
<span id="tx_674" class="t s1_674">variables in the rule with unique new names. e reason for this is to </span>
<span id="ty_674" class="t s1_674" data-mappings='[[28,"ff"]]'>prevent the variables for diﬀerent rule applications from becoming con- </span>
<span id="tz_674" class="t s1_674">fused with each other. For instance, if two rules both use a variable </span>
<span id="t10_674" class="t s1_674">named </span><span id="t11_674" class="t s2_674">?x</span><span id="t12_674" class="t s1_674">, then each one may add a binding for </span><span id="t13_674" class="t s2_674">?x </span><span id="t14_674" class="t s1_674">to the frame when it </span>
<span id="t15_674" class="t s1_674">is applied. ese two </span><span id="t16_674" class="t s2_674">?x</span><span id="t17_674" class="t s1_674">’s have nothing to do with each other, and we </span>
<span id="t18_674" class="t s1_674">should not be fooled into thinking that the two bindings must be con- </span>
<span id="t19_674" class="t s1_674">sistent. Rather than rename variables, we could devise a more clever </span>
<span id="t1a_674" class="t s1_674">environment structure; however, the renaming approach we have cho- </span>
<span id="t1b_674" class="t s1_674">sen here is the most straightforward, even if not the most eﬃcient. (See </span>
<span id="t1c_674" class="t s3_674">Exercise 4.79</span><span id="t1d_674" class="t s1_674">.) Here is the </span><span id="t1e_674" class="t s2_674">apply-a-rule </span><span id="t1f_674" class="t s1_674">procedure: </span>
<span id="t1g_674" class="t s4_674">(</span><span id="t1h_674" class="t s5_674">define </span><span id="t1i_674" class="t s4_674">(</span><span id="t1j_674" class="t s6_674">apply-a-rule rule query-pattern query-frame</span><span id="t1k_674" class="t s4_674">) </span>
<span id="t1l_674" class="t s4_674">(</span><span id="t1m_674" class="t s5_674">let </span><span id="t1n_674" class="t s4_674">((</span><span id="t1o_674" class="t s6_674">clean-rule </span><span id="t1p_674" class="t s4_674">(</span><span id="t1q_674" class="t s6_674">rename-variables-in rule</span><span id="t1r_674" class="t s4_674">))) </span>
<span id="t1s_674" class="t s4_674">(</span><span id="t1t_674" class="t s5_674">let </span><span id="t1u_674" class="t s4_674">((</span><span id="t1v_674" class="t s6_674">unify-result </span><span id="t1w_674" class="t s4_674">(</span><span id="t1x_674" class="t s6_674">unify-match query-pattern </span>
<span id="t1y_674" class="t s4_674">(</span><span id="t1z_674" class="t s6_674">conclusion clean-rule</span><span id="t20_674" class="t s4_674">) </span>
<span id="t21_674" class="t s6_674">query-frame</span><span id="t22_674" class="t s4_674">))) </span>
<span id="t23_674" class="t s4_674">(</span><span id="t24_674" class="t s5_674">if </span><span id="t25_674" class="t s4_674">(</span><span id="t26_674" class="t s7_674">eq? </span><span id="t27_674" class="t s6_674">unify-result 'failed</span><span id="t28_674" class="t s4_674">) </span>
<span id="t29_674" class="t s6_674">the-empty-stream </span>
<span id="t2a_674" class="t s4_674">(</span><span id="t2b_674" class="t s6_674">qeval </span><span id="t2c_674" class="t s4_674">(</span><span id="t2d_674" class="t s6_674">rule-body clean-rule</span><span id="t2e_674" class="t s4_674">) </span>
<span id="t2f_674" class="t s4_674">(</span><span id="t2g_674" class="t s6_674">singleton-stream unify-result</span><span id="t2h_674" class="t s4_674">)))))) </span>
<span id="t2i_674" class="t s1_674">646 </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
